<div align="center">

# Mersyar-Bot 🤖

### ربات تلگرام پیشرفته برای مدیریت هوشمند پنل مرزبان

![GitHub release (latest by date)](https://img.shields.io/github/v/release/mersvpn/mersyar-bot?style=for-the-badge&color=blue)
![GitHub last commit](https://img.shields.io/github/last-commit/mersvpn/mersyar-bot?style=for-the-badge&color=brightgreen)
![GitHub stars](https://img.shields.io/github/stars/mersvpn/mersyar-bot?style=for-the-badge&color=gold)

**mersyar bot** یک راهکار جامع و قدرتمند برای مدیریت کامل کاربران پنل **[Marzban](https://github.com/Gozargah/Marzban)** از طریق تلگرام است. این ربات با معماری ماژولار، قابلیت‌های گسترده و نصب آسان، فرآیند فروش و پشتیبانی از کاربران را برای شما خودکار و لذت‌بخش می‌کند.

</div>

---

## 🎯 فلسفه طراحی و معماری

این ربات با چند اصل کلیدی طراحی شده است:

-   **🧠 ماژولار بودن (Modularity):** تفکیک کامل کدها برای توسعه و نگهداری آسان.
-   **🔌 جداسازی مسئولیت‌ها (Separation of Concerns):** لایه‌های مجزا برای پایگاه داده، منطق کسب‌وکار و نمایش.
-   **🛡️ پایداری و مقاومت در برابر خطا:** دارای حالت تعمیر (Maintenance Mode) و مقاوم در برابر داده‌های ناقص از API.
-   **⚙️ داینامیک و قابل تنظیم:** تمام بخش‌های کلیدی مانند پلن‌های فروش و قیمت‌گذاری از طریق پنل ادمین در ربات قابل مدیریت هستند.

---

## ✨ ویژگی‌های کلیدی (Features)

ربات دارای دو پنل کاملاً مجزا برای **مدیر** و **مشتری** است.

### 👨‍💻 پنل مدیر (Admin Panel)

#### 📈 **مدیریت فروش و پلن‌ها (جدید!)**
-   **💎 مدیریت پلن‌های نامحدود:** افزودن، ویرایش، حذف و فعال/غیرفعال کردن پلن‌های **چندکاربره نامحدود** با قیمت و زمان دلخواه.
-   **💡 مدیریت پلن‌های حجمی:**
    -   تنظیم کامل پارامترهای **فرمول قیمت‌گذاری پلکانی**.
    -   امکان ویرایش "هزینه پایه روزانه" و مدیریت "پلکان‌های قیمتی" (سقف حجم و قیمت هر گیگ).
-   **⚙️ موتور قیمت‌گذاری پیشرونده:** محاسبه هوشمند و منصفانه قیمت بر اساس حجم و زمان درخواستی کاربر.

#### 👑 **مدیریت کاربران مرزبان**
-   **کاربران:** افزودن (یک‌کاربره و چندکاربره)، جستجو، مشاهده جزئیات کامل، ویرایش، حذف و تمدید هوشمند.
-   **اتصال و اطلاعات:** دریافت لینک اشتراک، QR Code و بازسازی لینک‌ها.
-   **یادداشت‌گذاری:** ثبت اطلاعات مالی (قیمت، مدت، تاریخ پرداخت) برای هر کاربر.
-   **جستجوی پیشرفته:** جستجو بر اساس نام کاربری، شماره تلفن یا یادداشت ثبت‌شده.

#### 🔧 **ابزارها و تنظیمات ربات**
-   **📡 مدیریت پنل مرزبان:** افزودن، ویرایش و مشاهده اطلاعات اتصال به پنل مرزبان از داخل ربات.
-   **🎨 تعریف کاربر الگو (Template):** تنظیم یک الگوی پیش‌فرض برای ساخت سریع کاربران جدید.
-   **📣 ارسال پیام همگانی (Broadcast):** ارسال پیام به تمام کاربران ربات یا یک کاربر خاص با قابلیت افزودن دک- **⏰ یادآور خودکار (Reminder):**
    -   دریافت گزارش روزانه از کاربرانی که حجم یا زمان اشتراکشان رو به اتمام است.
    -   ارسال خودکار پیام یادآوری تمدید برای مشتریان.
-   **🚦 حالت تعمیر:** فعال/غیرفعال کردن ربات برای کاربران عادی جهت انجام به‌روزرسانی‌ها.

### 👤 پنل مشتری (Customer Panel)

-   **🛒 خرید سرویس:**
    -   مشاهده لیست **پلن‌های نامحدود** و خرید مستقیم.
    -   امکان **ساخت پلن حجمی دلخواه** با انتخاب حجم و زمان مورد نیاز و دریافت قیمت آنی.
-   **📊 مشاهده وضعیت سرویس:** نمایش کامل حجم مصرفی، حجم باقی‌مانده و تاریخ انقضا.
-   **🔗 دریافت لینک اتصال:** دریافت مجدد لینک اشتراک و QR Code در هر زمان.
-   **🔄 درخواست تمدید:** ارسال درخواست تمدید برای سرویس فعلی.
-   **🧾 ارسال رسید پرداخت:** امکان ارسال عکس رسید برای ادمین جهت تایید پرداخت.
-   **📚 راهنمای اتصال:** دریافت راهنمای تصویری و متنی برای اتصال به سرویس‌ها.

---

## 🛠️ تکنولوژی‌های استفاده شده

| کامپوننت             | تکنولوژی                                                               |
| ------------------- | ---------------------------------------------------------------------- |
| **زبان برنامه‌نویسی** | `Python 3.10+`                                                         |
| **کتابخانه ربات**      | `python-telegram-bot (v20+)` (Async)                                   |
| **پایگاه داده**       | `MySQL` (با درایور `aiomysql` برای اتصالات غیرهمزمان)                   |
| **ارتباط با API**     | `httpx` (برای درخواست‌های Async به پنل مرزبان)                           |
| **محیط اجرایی**      | `Docker` و `Docker Compose` (برای نصب آسان و ایزوله)                      |

---

## 📋 پیش‌نیازها (Prerequisites)

1.  یک **سرور مجازی (VPS)** با سیستم‌عامل Debian یا Ubuntu.
2.  یک **دامنه یا زیردامنه** که رکورد A آن به آدرس IP سرور شما متصل باشد.
3.  یک **توکن ربات تلگرام** که از [@BotFather](https://t.me/BotFather) دریافت کرده‌اید.

---

## 🚀 نصب سریع و آسان (One-Line Install)


```markdown
برای نصب ربات، با دسترسی `root` به ترمینال سرور خود متصل شده و یکی از دستورات زیر را اجرا کنید.

---

### ۱. نصب با داکر (روش جدید و پیشنهادی)

این روش ربات و تمام نیازمندی‌های آن را در محیط ایزوله داکر نصب می‌کند. این روش پایدارتر است و از تداخل با سایر سرویس‌های روی سرور شما جلوگیری می‌کند.

```bash
bash <(curl -sL https://raw.githubusercontent.com/mersvpn/mersyar-bot/main/docker-install.sh)
```
پس از نصب، می‌توانید با دستور `mersyar` ربات خود را مدیریت کنید.

---

### ۲. نصب مستقیم روی سرور (روش قدیمی)

**توجه:** این روش ممکن است با سایر سرویس‌های روی سرور شما (مانند پنل مرزبان) تداخل داشته باشد. فقط در صورتی از این روش استفاده کنید که سرور شما کاملاً خالی باشد.

```bash
wget -O install.sh https://raw.githubusercontent.com/mersvpn/mersyar-bot/main/install.sh && chmod +x install.sh && ./install.sh
```



### پیکربندی پس از نصب

پس از اتمام نصب، ربات به صورت خودکار اجرا می‌شود. برای فعال‌سازی کامل، به عنوان ادمین وارد ربات خود شوید و:
1.  به منوی **"⚙️ تنظیمات و ابزارها"** بروید.
2.  دکمه **"🔐 مدیریت پنل مرزبان"** را بزنید.
3.  اطلاعات پنل مرزبان خود (آدرس، نام کاربری و رمز عبور) را وارد کنید تا ربات به پنل متصل شود.

---

## 📜 مدیریت ربات از طریق خط فرمان

پس از نصب، یک ابزار مدیریتی ساده و کاربردی در خط فرمان سرور شما فعال می‌شود. کافیست در هر مسیری از ترمینال، دستور `mersyar` را تایپ و اجرا کنید تا منوی زیر برای شما نمایش داده شود:

![Mersyar CLI Menu](https://raw.githubusercontent.com/mersvpn/mersyar-bot/main/mersyar-cli.png)

این منو به شما اجازه می‌دهد تا کارهای مدیریتی اصلی را بدون نیاز به دستورات پیچیده `docker` انجام دهید:
-   **نصب مجدد (Re-install):** اگر در مراحل نصب با مشکلی مواجه شدید، می‌توانید کل فرآیند را تکرار کنید.
-   **به‌روزرسانی (Update Bot):** ربات را به آخرین نسخه موجود در گیت‌هاب آپدیت می‌کند.
-   **مدیریت پشتیبان (Backup):** تهیه نسخه پشتیبان از دیتابیس ربات و بازگردانی آن.
-   **خروج (Exit):** خروج از منو.

---

## 🔄 به‌روزرسانی (Updating)

برای به‌روزرسانی ربات به آخرین نسخه، می‌توانید از یکی از دو روش زیر استفاده کنید:

1.  **روش اول (پیشنهادی):** از طریق منوی خط فرمان `mersyar` و انتخاب گزینه `Update Bot`.
2.  **روش دوم:** اجرای مجدد **دستور نصب یک خطی** روی سرور.

هر دو روش به صورت هوشمند عمل کرده و آخرین نسخه را از گیت‌هاب دریافت و جایگزین نسخه فعلی می‌کنند، بدون اینکه اطلاعات یا تنظیمات شما (مانند دیتابیس) از بین برود.

---

## 🤝 مشارکت (Contributing)

از مشارکت شما در این پروژه استقبال می‌کنیم. اگر ایده‌ای برای بهبود دارید یا باگی پیدا کرده‌اید، لطفاً یک **Issue** جدید ثبت کنید یا یک **Pull Request** ارسال نمایید.